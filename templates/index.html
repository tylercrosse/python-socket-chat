<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Chat</title>
  <link href="../static/mainStyle.css" rel='stylesheet' type="text/css">
  <script type="text/javascript" src="//code.jquery.com/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
  <script src="../static/client.js"></script>
</head>

<body>
  <div id="users"><strong>Users: </strong></div>
  <div id="messages"><strong>Messages: </strong></div>
  <script>
    $(function() {
      var socket = io();
      var users = {};
      var usersKeys = [];

      var updateUsersKeys = function () {
        usersKeys = Object.keys(users);
      }

      var updateUsersList = function () {
        updateUsersKeys()
        var key = '';
        $('#users').html('<strong>Users: </strong>');
        for (var i=0; i<usersKeys.length; i++) {
          key = usersKeys[i];
          user = users[key];
          $('#users').append('<p id='+ user +'>'+ user +'</p>');
        }
      };

      var addChatMessage = function (data, options) {
        $('#messages').append('<p>'+ data.username +': '+ data.message +'</p>');
      };

      //**** Socket Events ****//
      socket.on('users list', function(data) {
        if (data) {
          users = data;
          updateUsersList();
        }
      });

      socket.on('lobby message', function(data) {
        console.log(data);
        addChatMessage(data);
      });

    });
  </script>
</body>

</html>
